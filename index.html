<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Game Development Tutorial</title>
  <link rel="stylesheet" type="text/css" href="./css/styles.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

</head>
<body id="body">

  <div class="canvasWrapper">
    <canvas id="canvas"></canvas>
    <div class="info">
      <div class="lives">4</div>
      <div class="time">2:00</div>
      <div class="points">0</div>
    </div>
  </div>



  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="./js/controls.js"></script>
  <script src="./js/utility.js"></script>
  <script src="./js/canvas.js"></script>
  <script src="./js/animate.js"></script>
  <script src="./js/spritesheet.js"></script>
  <script src="./js/sprite.js"></script>
  <script src="./js/world.js"></script>
  <script src="./js/obstacles.js"></script>
  <script src="./js/fireballs.js"></script>
  <script src="./js/points.js"></script>
  <script src="./js/segment.js"></script>
  <script src="./js/collisions.js"></script>
  <script src="./js/dinamics.js"></script>
  <script language="javascript">

    //var context = null;
    //block_w = 32;
    //block_h = 32;
    block_w = 64;
    block_h = 64;

    //initial time
    //var time = 120;

    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');

    var wall = new Sprite('./images/wall.png',false);
    var water = new Sprite('./images/water.png',false);
    var water_bottom = new Sprite('./images/waterBottom.png',false);
    var wall_bottom = new Sprite('./images/wall_bottom.png',false);
    var dungeon_wall = new Sprite('./images/dungeon.png',false);
    var dungeon_bottom = new Sprite('./images/dungeon_bottom.png',false);
    var wood = new Sprite('./images/wood.png',false);
    var wood_bottom = new Sprite('./images/wood_bottom.png',false);
    var orange = new Sprite('./images/orange.png',false);
    var orange_bottom = new Sprite('./images/orange_bottom.png',false);
    var back_brown = new Sprite('./images/back_brown.png',false);
    var back_brown_bottom = new Sprite('./images/back_brown_bottom.png',false);
    var stones = new Sprite('./images/stones.png',false);

    //var guy = new Sprite('./images/guy.png');
    var guy = new Sprite('./images/blueGuy.png',false,4);
    var girl = new Sprite('./images/girl.png');
    var blueGuy = new Sprite('./images/blueGuy.png');
    var explosion = new Sprite('./images/explosion.png',false,4);


    //birds
    //map 0
    var bird = new Sprite('./images/bird.png',false,4,5*block_w,5*block_h);
    //map 1
    var bird2 = new Sprite('./images/bird.png',false,4,3*block_w,7*block_h);
    var bird3 = new Sprite('./images/bird.png',false,4,8*block_w,8*block_h);
    //map 2
    var bird4 = new Sprite('./images/bird.png',false,4,1*block_w,8*block_h);
    var bird5 = new Sprite('./images/bird.png',false,4,6*block_w,3*block_h);

    //map3
    var bird6 = new Sprite('./images/bird.png',false,4,2*block_w,7*block_h);
    var bird7 = new Sprite('./images/bird.png',false,4,4*block_w,6*block_h);

    //map4
    var bird8 = new Sprite('./images/bird.png',false,4,5*block_w,5*block_h);
    var bird9 = new Sprite('./images/bird.png',false,4,2*block_w,7*block_h);

    //map5
    var bird10 = new Sprite('./images/bird.png',false,4,3*block_w,0*block_h);
    var bird11 = new Sprite('./images/bird.png',false,4,7*block_w,7*block_h);

    //map6
    var bird12 = new Sprite('./images/bird.png',false,4,6*block_w,3*block_h);
    var bird14 = new Sprite('./images/bird.png',false,4,6*block_w,2*block_h);
    var bird16 = new Sprite('./images/bird.png',false,4,6*block_w,1*block_h);


    //map7
    var bird13 = new Sprite('./images/bird.png',false,4,3*block_w,4*block_h);
    var bird15 = new Sprite('./images/bird.png',false,4,3*block_w,0*block_h);


    //fireballs
    // map 1
    var fireball = new Sprite('./images/fireball.png',false,8,7*block_w,4*block_h);

    //map2
    var fireball2 = new Sprite('./images/fireball.png',false,8,4*block_w,6*block_h);
    var fireball3 = new Sprite('./images/fireball.png',false,8,7*block_w,6*block_h);

    //map3
    var fireball4 = new Sprite('./images/fireball.png',false,8,5*block_w,1*block_h);

    //map 4
    var fireball5 = new Sprite('./images/fireball.png',false,8,9*block_w,2*block_h);

    //map 5
    var fireball6 = new Sprite('./images/fireball.png',false,8,1*block_w,5*block_h);
    var fireball7 = new Sprite('./images/fireball.png',false,8,3*block_w,7*block_h);

    //map 6
    //var fireball8 = new Sprite('./images/fireball.png',false,8,3*block_w,7*block_h);

    //map 7
    var fireball9 = new Sprite('./images/fireball.png',false,8,7*block_w,0*block_h);
    var fireball10 = new Sprite('./images/fireball.png',false,8,7*block_w,3*block_h);

    //var spritesheet = new Spritesheet('./images/guy.png');
    //var guy2 = new Sprite(spritesheet);

    //var birds_array = [bird];

    var birds_per_map = {
      0: [bird],
      1: [bird2,bird3],
      2: [bird4,bird5],
      3: [bird6,bird7],
      4: [bird8,bird,9],
      5: [bird10,bird11],
      6: [bird12,bird14,bird16],
      7: [bird13,bird15]
    };

    var fireballs_per_map = {
      1: [fireball],
      2: [fireball2, fireball3],
      3: [fireball4],
      4: [fireball5],
      5: [fireball6, fireball7],
      7: [fireball9, fireball10]
    };

    var guy_x = 0;
    var guy_y = 256;

    //var jumpMax = 2;
    //var jumping_available = true;


    $(document).ready(function() {

      canvas.width = 640;
      canvas.height = 640;

      initializeKeyboard();

      disableScrollBar();

      initializeAnimationCounters();

      var currMap = 0;

      var point = new Point(100,100);


      setInterval(function() {
          updateTime();
      }, 1000);

      setInterval(function() {

        resetAnimationCounter();

        if(!landed) {
          guy_y += guy.gravity;
        }

        if (guy.pos_x_in_map === 9) {
          console.log('reached right corner');
          currMap++;
          guy_x = 0;
        }
        if (guy.pos_x_in_map <= -1) {
          console.log('reached left corner');
          //check for 570, guy_y
          var x_prev = Math.floor(570/64);
          var y_prev = Math.floor(guy.pos_y/64);
          var index_prev = xy2i(x_prev, y_prev,10);
          if(map[currMap-1][index_prev] === 0) {
            console.log("can't go left!");
            guy_x = 0;
          } else {
            currMap--;
            guy_x = 570;
          }
        }
        if (currMap === 8 && guy.pos_y_in_map <=-2) {
          console.log("outside!");
        }

        drawMap(map[currMap]);

        //point.draw(5,'red');

        var spriteI = [8,9,10,11];


        if (key.space) {
          if (can_go_up/* && !key.upArrow*/) {

              guy.jump()
              guy.jumpMax -= 0.5;

          } else {
            console.log("can't go up");
          }
        }

        check_if_wall(map[currMap]);
        check_if_bird(guy_x, guy_y,currMap);
        check_if_fireball(guy_x, guy_y,currMap);

        if (key.leftArrow) {
          spriteI = [4,5,6,7];
          if(can_go_left) {
            if (!is_shift) {
              guy_x -= 6;
            } else {
              guy_x -= 6;
            }
          }
        }
        if (key.upArrow) {
          spriteI = [12,13,14,15];
          if(can_go_up) {
            if (!is_shift) {
              guy_y -= 4;
            } else {
              guy_y -= 6;
            }
          }
        }
        if (key.rightArrow) {
          spriteI = [8,9,10,11];
          if (can_go_right) {
            //check_if_bird(guy_x + 6, guy_y,currMap);
            if (!is_shift) {
              guy_x += 6;
            } else {
              guy_x += 6;
            }
          }
        }
        if (key.downArrow) {
          spriteI = [0,1,2,3];
          if (can_go_down) {
            if (!is_shift) {
              guy_y += 4;
            } else {
              guy_y += 6;
            }
          }
        }

        setObstacles(currMap);
        setFireBalls(currMap);


        guy.draw(guy_x,guy_y,spriteI);


      }, 24);



    });


  </script>
</body>
</html>
